(function($){if(typeof $.fn.each2=="undefined"){$.fn.extend({each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this;}});}})(jQuery);(function($,undefined){"use strict";if(window.Select2!==undefined){return;}
var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer;KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true;}
return false;},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true;}
if(e.metaKey)return true;return false;},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123;}};nextUid=(function(){var counter=1;return function(){return counter++;};}());function indexOf(value,array){var i=0,l=array.length,v;if(typeof value==="undefined"){return-1;}
if(value.constructor===String){for(;i<l;i=i+1)if(value.localeCompare(array[i])===0)return i;}else{for(;i<l;i=i+1){v=array[i];if(v.constructor===String){if(v.localeCompare(value)===0)return i;}else{if(v===value)return i;}}}
return-1;}
function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a.localeCompare(b)===0;if(b.constructor===String)return b.localeCompare(a)===0;return false;}
function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val;}
function getSideBorderPadding(element){return element.outerWidth()-element.width();}
function installKeyUpChangeEvent(element){var key="keyup-change-value";element.bind("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val());}});element.bind("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change");}});}
$(document).delegate("body","mousemove",function(e){$.data(document,"select2-lastpos",{x:e.pageX,y:e.pageY});});function installFilteredMouseMove(element){element.bind("mousemove",function(e){var lastpos=$.data(document,"select2-lastpos");if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e);}});}
function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args);},quietMillis);};}
function thunk(formula){var evaluated=false,value;return function(){if(evaluated===false){value=formula();evaluated=true;}
return value;};};function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e);});element.bind("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e);});}
function killEvent(event){event.preventDefault();event.stopPropagation();}
function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});$("body").append(sizer);}
sizer.text(e.val());return sizer.width();}
function markMatch(text,term,markup){var match=text.toUpperCase().indexOf(term.toUpperCase()),tl=term.length;if(match<0){markup.push(text);return;}
markup.push(text.substring(0,match));markup.push("<span class='select2-match'>");markup.push(text.substring(match,match+tl));markup.push("</span>");markup.push(text.substring(match+tl,text.length));}
function ajax(options){var timeout,requestSequence=0,handler=null,quietMillis=options.quietMillis||100;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){requestSequence+=1;var requestNumber=requestSequence,data=options.data,transport=options.transport||$.ajax,traditional=options.traditional||false,type=options.type||'GET';data=data.call(this,query.term,query.page,query.context);if(null!==handler){handler.abort();}
handler=transport.call(null,{url:options.url,dataType:options.dataType,data:data,type:type,traditional:traditional,success:function(data){if(requestNumber<requestSequence){return;}
var results=options.results(data,query.page);query.callback(results);}});},quietMillis);};}
function local(options){var data=options,dataText,text=function(item){return""+item.text;};if(!$.isArray(data)){text=data.text;if(!$.isFunction(text)){dataText=data.text;text=function(item){return item[dataText];};}
data=data.results;}
return function(query){var t=query.term,filtered={results:[]},process;if(t===""){query.callback({results:data});return;}
process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum){if(datum.hasOwnProperty(attr))group[attr]=datum[attr];}
group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children);});if(group.children.length){collection.push(group);}}else{if(query.matcher(t,text(datum))){collection.push(datum);}}};$(data).each2(function(i,datum){process(datum,filtered.results);});query.callback(filtered);};}
function tags(data){if($.isFunction(data)){return data;}
return function(query){var t=query.term,filtered={results:[]};$(data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this});}});query.callback(filtered);};}
function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return false;throw new Error("formatterName must be a function or a falsy value");}
function evaluate(val){return $.isFunction(val)?val():val;}
function countResults(results){var count=0;$.each(results,function(i,item){if(item.children){count+=countResults(item.children);}else{count++;}});return count;}
function defaultTokenizer(input,selection,selectCallback,opts){var original=input,dupe=false,token,index,i,l,separator;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;while(true){index=-1;for(i=0,l=opts.tokenSeparators.length;i<l;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break;}
if(index<0)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice(token,selection);if(token!==undefined&&token!==null&&opts.id(token)!==undefined&&opts.id(token)!==null){dupe=false;for(i=0,l=selection.length;i<l;i++){if(equal(opts.id(token),opts.id(selection[i]))){dupe=true;break;}}
if(!dupe)selectCallback(token);}}}
if(original.localeCompare(input)!=0)return input;}
$(document).ready(function(){$(document).delegate("body","mousedown touchend",function(e){var target=$(e.target).closest("div.select2-container").get(0),attr;if(target){$(document).find("div.select2-container-active").each(function(){if(this!==target)$(this).data("select2").blur();});}else{target=$(e.target).closest("div.select2-drop").get(0);$(document).find("div.select2-drop-active").each(function(){if(this!==target)$(this).data("select2").blur();});}
target=$(e.target);attr=target.attr("for");if("LABEL"===e.target.tagName&&attr&&attr.length>0){target=$("#"+attr);target=target.data("select2");if(target!==undefined){target.focus();e.preventDefault();}}});});function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor;}
AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments);};},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){this.destroy();}
this.enabled=true;this.container=this.createContainer();this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,'\\$1');this.container.attr("id",this.containerId);this.body=thunk(function(){return opts.element.closest("body");});if(opts.element.attr("class")!==undefined){this.container.addClass(opts.element.attr("class").replace(/validate\[[\S ]+] ?/,''));}
this.container.css(evaluate(opts.containerCss));this.container.addClass(evaluate(opts.containerCssClass));this.opts.element.data("select2",this).hide().before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(evaluate(opts.dropdownCssClass));this.dropdown.data("select2",this);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");search.attr("tabIndex",this.opts.element.attr("tabIndex"));this.resultsPage=0;this.context=null;this.initContainer();this.initContainerWidth();installFilteredMouseMove(this.results);this.dropdown.delegate(resultsSelector,"mousemove-filtered",this.bind(this.highlightUnderEvent));installDebouncedScroll(80,this.results);this.dropdown.delegate(resultsSelector,"scroll-debounced",this.bind(this.loadMoreIfNeeded));if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop(),height;if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e);}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e);}});}
installKeyUpChangeEvent(search);search.bind("keyup-change",this.bind(this.updateResults));search.bind("focus",function(){search.addClass("select2-focused");if(search.val()===" ")search.val("");});search.bind("blur",function(){search.removeClass("select2-focused");});this.dropdown.delegate(resultsSelector,"mouseup",this.bind(function(e){if($(e.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e);}else{this.focusSearch();}
killEvent(e);}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation();});if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource();}
if(opts.element.is(":disabled")||opts.element.is("[readonly='readonly']"))this.disable();},destroy:function(){var select2=this.opts.element.data("select2");if(select2!==undefined){select2.container.remove();select2.dropdown.remove();select2.opts.element.removeData("select2").unbind(".select2").show();}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element;}
if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");}});}
opts=$.extend({},{populateResults:function(container,results,query){var populate,data,result,children,id=this.opts.id,self=this;populate=function(results,container,depth){var i,l,result,selectable,compound,node,label,innerContainer,formatted;for(i=0,l=results.length;i<l;i=i+1){result=results[i];selectable=id(result)!==undefined;compound=result.children&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(compound){node.addClass("select2-result-with-children");}
node.addClass(self.opts.formatResultCssClass(result));label=$("<div></div>");label.addClass("select2-result-label");formatted=opts.formatResult(result,label,query);if(formatted!==undefined){label.html(self.opts.escapeMarkup(formatted));}
node.append(label);if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer);}
node.data("select2-data",result);container.append(node);}};populate(results,container,0);}},$.fn.select2.defaults,opts);if(typeof(opts.id)!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey];};}
if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,firstChild,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push({id:element.attr("value"),text:element.text(),element:element.get(),css:element.attr("class")});}}else if(element.is("optgroup")){group={text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};element.children().each2(function(i,elm){process(elm,group.children);});if(group.children.length>0){collection.push(group);}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){firstChild=children[0];if($(firstChild).text()===""){children=children.not(firstChild);}}
children.each2(function(i,elm){process(elm,data.results);});query.callback(data);});opts.id=function(e){return e.id;};opts.formatResultCssClass=function(data){return data.css;}}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl;}
opts.query=ajax(opts.ajax);}else if("data"in opts){opts.query=local(opts.data);}else if("tags"in opts){opts.query=tags(opts.tags);opts.createSearchChoice=function(term){return{id:term,text:term};};opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var id=this,text=this,tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,id)){text=this.text;return false;}});data.push({id:id,text:text});});callback(data);};}}}
if(typeof(opts.query)!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id");}
return opts;},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection();}}));},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange)
this.opts.element.blur();},enable:function(){if(this.enabled)return;this.enabled=true;this.container.removeClass("select2-container-disabled");},disable:function(){if(!this.enabled)return;this.close();this.enabled=false;this.container.addClass("select2-container-disabled");},opened:function(){return this.container.hasClass("select2-dropdown-open");},positionDropdown:function(){var offset=this.container.offset(),height=this.container.outerHeight(),width=this.container.outerWidth(),dropHeight=this.dropdown.outerHeight(),viewportBottom=$(window).scrollTop()+document.documentElement.clientHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=(offset.top-dropHeight)>=this.body().scrollTop(),aboveNow=this.dropdown.hasClass("select2-drop-above"),bodyOffset,above,css;if(this.body().css('position')!=='static'){bodyOffset=this.body().offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left;}
if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow)above=false;}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove)above=true;}
if(above){dropTop=offset.top-dropHeight;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above");}
else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");}
css=$.extend({top:dropTop,left:dropLeft,width:width},evaluate(this.opts.dropdownCss));this.dropdown.css(css);},shouldOpen:function(){var event;if(this.opened())return false;event=$.Event("open");this.opts.element.trigger(event);return!event.isDefaultPrevented();},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");},open:function(){if(!this.shouldOpen())return false;window.setTimeout(this.bind(this.opening),1);return true;},opening:function(){var cid=this.containerId,selector=this.containerSelector,scroll="scroll."+cid,resize="resize."+cid;this.container.parents().each(function(){$(this).bind(scroll,function(){var s2=$(selector);if(s2.length==0){$(this).unbind(scroll);}
s2.select2("close");});});$(window).bind(resize,function(){var s2=$(selector);if(s2.length==0){$(window).unbind(resize);}
s2.select2("close");});this.clearDropdownAlignmentPreference();if(this.search.val()===" "){this.search.val("");}
this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.updateResults(true);if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body());}
this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();this.focusSearch();},close:function(){if(!this.opened())return;var self=this;this.container.parents().each(function(){$(this).unbind("scroll."+self.containerId);});$(window).unbind("resize."+this.containerId);this.clearDropdownAlignmentPreference();this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.opts.element.trigger($.Event("close"));},clearSearch:function(){},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return;}
children=results.find(".select2-result-selectable");child=$(children[index]);hb=child.offset().top+child.outerHeight();if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight();}}
rb=results.offset().top+results.outerHeight();if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb));}
y=child.offset().top-results.offset().top;if(y<0){results.scrollTop(results.scrollTop()+y);}},moveHighlight:function(delta){var choices=this.results.find(".select2-result-selectable"),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")){this.highlight(index);break;}}},highlight:function(index){var choices=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get());}
if(index>=choices.length)index=choices.length-1;if(index<0)index=0;choices.removeClass("select2-highlighted");$(choices[index]).addClass("select2-highlighted");this.ensureHighlightVisible();},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length;},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.results.find('.select2-result-selectable');this.highlight(choices.index(el));}else if(el.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted");}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,offset=-1,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=0){more.addClass("select2-active");this.opts.query({term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(!self.opened())return;self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});if(data.more===true){more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));window.setTimeout(function(){self.loadMoreIfNeeded();},10);}else{more.remove();}
self.positionDropdown();self.resultsPage=page;})});}},tokenize:function(){},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this,input;if(initial!==true&&(this.showSearchInput===false||!this.opened())){return;}
search.addClass("select2-active");function postRender(){results.scrollTop(0);search.removeClass("select2-active");self.positionDropdown();}
function render(html){results.html(self.opts.escapeMarkup(html));postRender();}
if(opts.maximumSelectionSize>=1){data=this.data();if($.isArray(data)&&data.length>=opts.maximumSelectionSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+opts.formatSelectionTooBig(opts.maximumSelectionSize)+"</li>");return;}}
if(search.val().length<opts.minimumInputLength&&checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+opts.formatInputTooShort(search.val(),opts.minimumInputLength)+"</li>");return;}
else{render("<li class='select2-searching'>"+opts.formatSearching()+"</li>");}
input=this.tokenize();if(input!=undefined&&input!=null){search.val(input);}
this.resultsPage=1;opts.query({term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(!this.opened())return;this.context=(data.context===undefined)?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(null,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def));}).length===0){data.results.unshift(def);}}}
if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+opts.formatNoMatches(search.val())+"</li>");return;}
results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded();},10);}
this.postprocessResults(data,initial);postRender();})});},cancel:function(){this.close();},blur:function(){this.close();this.container.removeClass("select2-container-active");this.dropdown.removeClass("select2-drop-active");if(this.search[0]===document.activeElement){this.search.blur();}
this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");},focusSearch:function(){this.search.show();this.search.focus();window.setTimeout(this.bind(function(){this.search.show();this.search.focus();this.search.val(this.search.val());}),10);},selectHighlighted:function(){var index=this.highlight(),highlighted=this.results.find(".select2-highlighted").not(".select2-disabled"),data=highlighted.closest('.select2-result-selectable').data("select2-data");if(data){highlighted.addClass("select2-disabled");this.highlight(index);this.onSelect(data);}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder;},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l;if(this.opts.width==="off"){return null;}else if(this.opts.width==="element"){return this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px';}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr('style');if(style!==undefined){attrs=style.split(';');for(i=0,l=attrs.length;i<l;i=i+1){matches=attrs[i].replace(/\s/g,'').match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(matches!==null&&matches.length>=1)
return matches[1];}}
if(this.opts.width==="resolve"){style=this.opts.element.css('width');if(style.indexOf("%")>0)return style;return(this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px');}
return null;}else if($.isFunction(this.opts.width)){return this.opts.width();}else{return this.opts.width;}};var width=resolveContainerWidth.call(this);if(width!==null){this.container.attr("style","width: "+width);}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container"}).html(["    <a href='#' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},opening:function(){this.search.show();this.parent.opening.apply(this,arguments);this.dropdown.removeClass("select2-offscreen");},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show();},focus:function(){this.close();this.selection.focus();},isFocused:function(){return this.selection[0]===document.activeElement;},cancel:function(){this.parent.cancel.apply(this,arguments);this.selection.focus();},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,clickingInside=false;this.selection=selection=container.find(".select2-choice");this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.TAB:case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}else{if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
this.open();if(e.which===KEY.ENTER){return;}}}));this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1");}));this.search.bind("blur",this.bind(function(){if(!this.opened())this.container.removeClass("select2-container-active");window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("mousedown",this.bind(function(e){clickingInside=true;if(this.opened()){this.close();this.selection.focus();}else if(this.enabled){this.open();}
clickingInside=false;}));dropdown.bind("mousedown",this.bind(function(){this.search.focus();}));selection.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");this.search.attr("tabIndex","-1");}));selection.bind("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active");}
window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
if(e.which==KEY.DELETE){if(this.opts.allowClear){this.clear();}
return;}
this.open();if(e.which===KEY.ENTER){killEvent(e);return;}
if(e.which<48){killEvent(e);return;}
var keyWritten=String.fromCharCode(e.which).toLowerCase();if(e.shiftKey){keyWritten=keyWritten.toUpperCase();}
this.search.focus();this.search.val(keyWritten);killEvent(e);}));selection.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear();killEvent(e);this.close();this.triggerChange();this.selection.focus();}));this.setPlaceholder();this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");}));},clear:function(){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();},initSelection:function(){var selected;if(this.opts.element.val()===""){this.close();this.setPlaceholder();}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder();}});}},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find(":selected");if($.isFunction(callback))
callback({id:selected.attr("value"),text:selected.text()});};}
return opts;},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.opts.element.val()===""&&placeholder!==undefined){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.selection.find("abbr").hide();}},postprocessResults:function(data,initial){var selected=0,self=this,showSearchInput=true;this.results.find(".select2-result-selectable").each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false;}});this.highlight(selected);if(initial===true){showSearchInput=this.showSearchInput=countResults(data.results)>=this.opts.minimumResultsForSearch;this.dropdown.find(".select2-search")[showSearchInput?"removeClass":"addClass"]("select2-search-hidden");$(this.dropdown,this.container)[showSearchInput?"addClass":"removeClass"]("select2-with-searchbox");}},onSelect:function(data){var old=this.opts.element.val();this.opts.element.val(this.id(data));this.updateSelection(data);this.close();this.selection.focus();if(!equal(old,this.id(data))){this.triggerChange();}},updateSelection:function(data){var container=this.selection.find("span"),formatted;this.selection.data("select2-data",data);container.empty();formatted=this.opts.formatSelection(data,container);if(formatted!==undefined){container.append(this.opts.escapeMarkup(formatted));}
this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.selection.find("abbr").show();}},val:function(){var val,data=null,self=this;if(arguments.length===0){return this.opts.element.val();}
val=arguments[0];if(this.select){this.select.val(val).find(":selected").each2(function(i,elm){data={id:elm.attr("value"),text:elm.text()};return false;});this.updateSelection(data);this.setPlaceholder();}else{if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined");}
if(!val){this.clear();return;}
this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder();});}},clearSearch:function(){this.search.val("");},data:function(value){var data;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data;}else{if(!value||value===""){this.clear();}else{this.opts.element.val(!value?"":this.id(value));this.updateSelection(value);}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find(":selected").each2(function(i,elm){data.push({id:elm.attr("value"),text:elm.text()});});if($.isFunction(callback))
callback(data);};}
return opts;},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.BACKSPACE&&this.search.val()===""){this.close();var choices,selected=selection.find(".select2-search-choice-focus");if(selected.length>0){this.unselect(selected.first());this.search.width(10);killEvent(e);return;}
choices=selection.find(".select2-search-choice");if(choices.length>0){choices.last().addClass("select2-search-choice-focus");}}else{selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:case KEY.TAB:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.clearSearch();e.stopImmediatePropagation();}));this.container.delegate(selector,"mousedown",this.bind(function(e){if(!this.enabled)return;if($(e.target).closest(".select2-search-choice").length>0){return;}
this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault();}));this.container.delegate(selector,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder();}));this.clearSearch();},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled");},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments);this.search.attr("disabled",true);},initSelection:function(){var data;if(this.opts.element.val()===""){this.updateSelection([]);this.close();this.clearSearch();}
if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch();}});}},clearSearch:function(){var placeholder=this.getPlaceholder();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.resizeSearch();}else{this.search.val(" ").width(10);}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default");}else{if(this.search.val()===" ")this.search.val("");}},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch();},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);},focus:function(){this.close();this.search.focus();},isFocused:function(){return this.search.hasClass("select2-focused");},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this);}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this);});self.postprocessResults();},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer(input,this.data(),this.bind(this.onSelect),this.opts);if(input!=null&&input!=undefined){this.search.val(input);if(input.length>0){this.open();}}},onSelect:function(data){this.addSelectedChoice(data);if(this.select){this.postprocessResults();}
if(this.opts.closeOnSelect){this.close();this.search.width(10);}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();this.positionDropdown();}else{this.close();}}
this.triggerChange({added:data});this.focusSearch();},cancel:function(){this.close();this.focusSearch();},addSelectedChoice:function(data){var choice=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),id=this.id(data),val=this.getVal(),formatted;formatted=this.opts.formatSelection(data,choice);choice.find("div").replaceWith("<div>"+this.opts.escapeMarkup(formatted)+"</div>");choice.find(".select2-search-choice-close").bind("mousedown",killEvent).bind("click dblclick",this.bind(function(e){if(!this.enabled)return;$(e.target).closest(".select2-search-choice").fadeOut('fast',this.bind(function(){this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch();})).dequeue();killEvent(e);})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");}));choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val);},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice";}
data=selected.data("select2-data");index=indexOf(this.id(data),val);if(index>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults();}
selected.remove();this.triggerChange({removed:data});},postprocessResults:function(){var val=this.getVal(),choices=this.results.find(".select2-result-selectable"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-disabled").removeClass("select2-result-selectable");}else{choice.removeClass("select2-disabled").addClass("select2-result-selectable");}});compound.each2(function(i,e){if(e.find(".select2-result-selectable").length==0){e.addClass("select2-disabled");}else{e.removeClass("select2-disabled");}});choices.each2(function(i,choice){if(!choice.hasClass("select2-disabled")&&choice.hasClass("select2-result-selectable")){self.highlight(0);return false;}});},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding;}
this.search.width(searchWidth);},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val;}else{val=this.opts.element.val();return splitVal(val,this.opts.separator);}},setVal:function(val){var unique;if(this.select){this.select.val(val);}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this);});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator));}},val:function(){var val,data=[],self=this;if(arguments.length===0){return this.getVal();}
val=arguments[0];if(!val){this.opts.element.val("");this.updateSelection([]);this.clearSearch();return;}
this.setVal(val);if(this.select){this.select.find(":selected").each(function(){data.push({id:$(this).attr("value"),text:$(this).text()});});this.updateSelection(data);}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined")}
this.opts.initSelection(this.opts.element,function(data){var ids=$(data).map(self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();});}
this.clearSearch();},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");}
this.search.width(0);this.searchContainer.hide();},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")));});this.setVal(val);this.triggerChange();},data:function(values){var self=this,ids;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data");}).get();}else{if(!values){values=[];}
ids=$.map(values,function(e){return self.opts.id(e)});this.setVal(ids);this.updateSelection(values);this.clearSearch();}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,value,multiple,allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(args.length===0||typeof(args[0])==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.attr("multiple");}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true;}}
select2=multiple?new MultiSelect2():new SingleSelect2();select2.init(opts);}else if(typeof(args[0])==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0];}
value=undefined;select2=$(this).data("select2");if(select2===undefined)return;if(args[0]==="container"){value=select2.container;}else{value=select2[args[0]].apply(select2,args.slice(1));}
if(value!==undefined){return false;}}else{throw"Invalid arguments to select2 plugin: "+args;}});return(value===undefined)?this:value;};$.fn.select2.defaults={width:"copy",closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query){var markup=[];markMatch(result.text,query.term,markup);return markup.join("");},formatSelection:function(data,container){return data?data.text:undefined;},formatResultCssClass:function(data){return undefined;},formatNoMatches:function(){return"No matches found";},formatInputTooShort:function(input,min){return"Please enter "+(min-input.length)+" more characters";},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(limit==1?"":"s");},formatLoadMore:function(pageNumber){return"Loading more results...";},formatSearching:function(){return"Searching...";},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id;},matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())>=0;},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:function(markup){if(markup&&typeof(markup)==="string"){return markup.replace(/&/g,"&amp;");}
return markup;},blurOnChange:false};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch},"class":{"abstract":AbstractSelect2,"single":SingleSelect2,"multi":MultiSelect2}};}(jQuery));
'use strict';var workoverFrontendApp=angular.module('workover',['ui','NotifcationsService']).config(['$routeProvider',function($routeProvider){$routeProvider.when('/courses/list',{templateUrl:'views/courses/list.html',controller:'Courses/ListCtrl'}).when('/courses/add',{templateUrl:'views/courses/add.html',controller:'Courses/AddCtrl'}).when('/questions/list',{templateUrl:'views/questions/list.html',controller:'Questions/ListCtrl'}).when('/students/list',{templateUrl:'views/students/list.html',controller:'Students/ListCtrl'}).when('/students/add',{templateUrl:'views/students/add.html',controller:'Students/AddCtrl'}).otherwise({redirectTo:'/courses/list'});}]);
'use strict';var app=angular.module('workover');app.directive('checkboxModel',function($compile){return{scope:{model:'=checkboxModel'},link:function($scope,element,attrs){$scope.$on('checkboxModel.selectAll',function($event,value){$scope.$apply(function(){$scope.model=value;element.prop('checked',value);});});$scope.$watch('model',function(newVal,oldVal){if(!(typeof newVal==='undefined'&&typeof oldVal==='undefined')){$scope.$emit('checkboxModel.selected',newVal);}});element.bind('click',function($event){$scope.$apply(function(){$scope.model=$event.target.checked;});});}};}).directive('checkboxModelAll',function($compile){return{scope:{objects:'=checkboxModelAll',disableActions:'=disableActions'},link:function($scope,element,attrs){element.bind('click',function($event){$scope.$parent.$broadcast('checkboxModel.selectAll',$event.target.checked);});var numSelected=0;$scope.disableActions=true;$scope.$parent.$on('checkboxModel.selected',function($event,value){value?numSelected++:numSelected--;if(numSelected>=$scope.objects.length){element.prop('checked',true);}else{element.prop('checked',false);}
if(numSelected>0){$scope.disableActions=false;}else{$scope.disableActions=true;}});}};}).directive('truncate',function($compile){return{scope:{text:'@truncate'},replace:true,template:'<span>{{innerText}}<span ng-show="innerText.length > length-1">{{dotdotdot}} <a ng-click="changeMoreLess()">&#40;show {{moreLess}}&#41;</a></span></span>',link:function(scope,element,attrs){var more=false;scope.length=attrs.truncateLength;if(typeof attrs.truncateLength==='undefined'){scope.length=100;}
var truncate=function(val){if(more){return val;}else{return val.substring(0,scope.length);}}
scope.moreLess='more';scope.dotdotdot='...';scope.changeMoreLess=function(){more=!more;if(more){scope.moreLess='less';scope.dotdotdot=''}else{scope.moreLess='more';scope.dotdotdot='...';}
scope.innerText=truncate(scope.text);}
scope.$watch('text',function(newVal){scope.innerText=truncate(newVal);});}};}).directive('placeholder',function($timeout){if(!$.browser.msie||$.browser.version>=10){return{};}
return{link:function(scope,elm,attrs){if(attrs.type==='password'){return;}
$timeout(function(){elm.val(attrs.placeholder).focus(function(){if($(this).val()==$(this).attr('placeholder')){$(this).val('');}}).blur(function(){if($(this).val()==''){$(this).val($(this).attr('placeholder'));}});});}}}).directive('courseSelector',function($rootScope){return{replace:true,template:'<select ui-select2 ng-model="currentCourseId" class="select2-fullwidth"><option ng-repeat="course in courses" value="{{course.id}}">{{course.code}}</option></select>',scope:{},controller:function($scope,CourseSelector){$scope.$watch(function(){return CourseSelector.courses},function(courses){$scope.courses=courses;});$scope.$watch(function(){return CourseSelector.currentCourse},function(currentCourse){$scope.currentCourseId=currentCourse.id;});$scope.$watch('currentCourseId',function(currentCourseId){CourseSelector.updateCurrentCourse(currentCourseId);});},link:function($scope,element,attrs){}};}).directive('addTag',function(Tag){return{replace:true,template:'<span><a ng-show="!showState">&#40;add&#41;</a> <input ng-show="showState" ng-model="newTagName" style="width: 80px;" placeholder="enter tag"></input></span>',scope:{addTag:'=',questionId:'=',},link:function($scope,elem,attrs){$scope.showState=false;$scope.newTagName='';var add=elem.children('a');var input=elem.children('input');var showInput=function(){$scope.$apply(function(){$scope.showState=true;});input.focus();};var addTag=function(){if($scope.newTagName!=''&&$scope.addTag.indexOf($scope.newTagName)<0){Tag.create({question_id:$scope.questionId,tag_name:$scope.newTagName}).then(function(){$scope.addTag.push($scope.newTagName);$scope.newTagName='';$scope.showState=false;});}else{$scope.$apply(function(){$scope.newTagName='';$scope.showState=false;});}};add.bind('click',showInput);input.bind('blur',addTag);input.bind('keypress',function(e){if(e.which==13){addTag();}})}};}).directive('delTag',function(Tag){return{scope:{delTag:'=',questionId:'=',tagName:'='},link:function($scope,elem,attrs){elem.bind('click',function(){Tag.remove({question_id:$scope.questionId,tag_name:$scope.tagName}).then(function(){var index=$scope.delTag.indexOf($scope.newTagName);$scope.delTag.splice(index,1);});});}};}).directive('fineUploader',function(NotificationsService){return{scope:{success:'='},link:function($scope,elem,attrs){var filetype='csv';if(!!attrs.filetype){filetype=attrs.filetype;}
elem.fineUploader({request:{endpoint:'/workover/users/1/upload/'+filetype},validation:{allowedExtensions:['csv'],acceptFiles:'csv'},}).on('submit',function(id,filename){$scope.$apply(function(){NotificationsService.push({title:'Uploading file...',type:'info'});});}).on('complete',function(event,id,fileName,response){if(response&&!!response.success&&!!response.file_output){$scope.$apply(function(){$scope.success(response.file_output);});$('#upload-students-done').tab('show');}}).on('error',function(id,fileName,reason){$scope.$apply(function(){NotificationsService.push({title:'Unable to succesfully upload file',type:'error'});});});}};});
'use strict';var app=angular.module('workover');app.service('CourseSelector',function($http,$q,$timeout,Course,Authuser){var self=this;self.courses=[];self.currentCourse={};var loadCourses=function(){var deferred=$q.defer();Course.list({'user_id':Authuser.id}).then(function(courses){self.courses=courses;deferred.resolve(courses);});return deferred.promise;}
var deferred=$q.defer();loadCourses().then(function(){deferred.resolve();});self.afterLoad=deferred.promise;$timeout(function(){self.afterLoad.then(function(){$timeout(function(){if(!self.currentCourse.id){self.resetCurrentCourse();}});});});this.reloadCourses=function(){var deferred=$q.defer();loadCourses().then(function(){deferred.resolve();});self.afterLoad=deferred.promise;}
this.updateCurrentCourse=function(newCurrentCourseId){var deferred=$q.defer();self.afterLoad.then(function(){var length=self.courses.length;for(var i=0;i<length;i++){if(self.courses[i].id==newCurrentCourseId){self.currentCourse=self.courses[i];deferred.resolve(self.currentCourse);}}
deferred.reject();});return deferred.promise;};this.resetCurrentCourse=function(reloadCourses){var deferred=$q.defer();if(reloadCourses){self.loadCourses().then(function(){if(self.courses.length<1){deferred.reject();}else{self.currentCourse=self.courses[0];deferred.resolve(self.currentCourse);}});}else{if(self.courses.length<1){deferred.reject();}else{self.currentCourse=self.courses[0];deferred.resolve(self.currentCourse);}}
return deferred.promise;}});
var app=angular.module('NotifcationsService',[],function($httpProvider){$httpProvider.responseInterceptors.push(function($q,NotificationsService){return function(promise){var deferred=$q.defer();promise.then(function(response){deferred.resolve(response);},function(response){console.log(response);NotificationsService.push({title:'Error '+response.status+'!',message:response.data.errors,type:'error'});deferred.reject(response);});return deferred.promise;}});});app.service('NotificationsService',function($timeout){this.notifications=[];var notifications=this.notifications;var primaryNotificationExists=false;var defaultTime=10;var nextNotificationId=1;this.push=function(notification){var that=this;notification.remove=function(){if(!angular.isUndefined(this.timeOut)){$timeout.cancel(this.timeOut);}
notifications.splice(notifications.indexOf(this),1);if(this.isPrimary){primaryNotificationExists=false;}}
if(!angular.isFunction(notification.click)){notification.click=notification.remove;}
if(angular.isUndefined(notification.isPrimary)){notification.isPrimary=true;}
if(notification.persistent!=true){notification.timeOut=$timeout(function(){notification.remove();},defaultTime*1000);}
if(notification.isPrimary==true&&primaryNotificationExists){notifications[0].remove();notifications.unshift(notification);primaryNotificationExists=true;}else if(notification.isPrimary==true&&!primaryNotificationExists){notifications.unshift(notification);primaryNotificationExists=true;}else{notifications.unshift(notification);}
return notification;};});
'use strict';var app=angular.module('workover');app.service('Authuser',function($http,$q){var User={id:1};return User;});
'use strict';var app=angular.module('workover');app.service('Student',function($http,$q,NotificationsService){this.list=function(params){var deferred=$q.defer();var queryString='';$http.get('/workover/courses/'+params.course_id+'/students').success(function(data){deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.add=function(params){var deferred=$q.defer();$http.post('/workover/courses/'+params.course_id+'/students/add',params.students).success(function(data){deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.remove=function(params){var deferred=$q.defer();$http.post('/workover/courses/'+params.course_id+'/students/remove',params.user_ids).success(function(data){NotificationsService.push({title:'Success!',message:'The selected students have been succesfully removed.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.reset_password=function(params){var deferred=$q.defer();$http.post('/workover/users/reset_password',{user_ids:params.user_ids,password:params.password}).success(function(data){NotificationsService.push({title:'Success!',message:'The selected students have been succesfully added.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};});
'use strict';var app=angular.module('workover');app.service('Course',function($http,$q,NotificationsService){this.list=function(params){var deferred=$q.defer();var queryString='';if(!angular.isUndefined(params)){if(!angular.isUndefined(params.user_id)){queryString+='user_id='+params.user_id;}}
$http.get('/workover/courses?'+queryString).success(function(data){deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.create=function(params){var deferred=$q.defer();$http.post('/workover/courses/create',params.question).success(function(data){NotificationsService.push({title:'Success!',message:'The course has been successfully created.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.remove_from_user=function(params){var deferred=$q.defer();$http.post('/workover/users/'+params.user_id+'/courses/delete',params.course_ids).success(function(data){NotificationsService.push({title:'Success!',message:'The course(s) has been removed from your courses.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.add_to_user=function(params){var deferred=$q.defer();$http.post('/workover/users/'+params.user_id+'/courses/add',params.course_ids).success(function(data){NotificationsService.push({title:'Success!',message:'The course(s) has been added to your courses.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;}});
'use strict';var app=angular.module('workover');app.service('Question',function($http,$q,NotificationsService){this.list=function(params){var deferred=$q.defer();var queryString='';if(params){if(!angular.isUndefined(params.include_tags)){queryString=queryString+'include_tags='+params.include_tags;}}
$http.get('/workover/courses/'+params.course_id+'/questions?'+queryString).success(function(data){deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};this.remove_from_course=function(params){var deferred=$q.defer();$http.post('courses/(:num)/questions/remove',{user_ids:params.user_ids,password:params.password}).success(function(data){NotificationsService.push({title:'Success!',message:'The selected students have been succesfully added.',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;};});
'use strict';var app=angular.module('workover');app.service('Tag',function($http,$q,NotificationsService){var Tag={create:function(params){var deferred=$q.defer();$http.post('/workover/questions/'+params.question_id+'/tags/add/'+params.tag_name).success(function(data){NotificationsService.push({title:'Tag Added!',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;},remove:function(params){var deferred=$q.defer();$http.post('/workover/questions/'+params.question_id+'/tags/remove/'+params.tag_name).success(function(data){NotificationsService.push({title:'Tag Removed!',type:'success'});deferred.resolve(data);}).error(function(data,status,headers,config){deferred.reject({'status':status,'data':data});});return deferred.promise;}};return Tag;});
'use strict';var app=angular.module('workover');app.controller('MainMenuCtrl',function($scope,$location){$scope.updateMenu=function(location){try{var reg=new RegExp("^/(.+)/");var result=reg.exec(location);if(!angular.isUndefined(result)){if(!angular.isUndefined(result.length)&&result.length>1){$scope.currentLocation=result[1];}}}catch(err){if(!angular.isUndefined(console)&&!angular.isUndefined(console.log)){console.log(err);}}}
$scope.$watch(function(){return $location.path();},function(path){$scope.updateMenu(path);});});
'use strict';var app=angular.module('workover');app.controller('NotificationsCtrl',function($scope,NotificationsService){$scope.$watch(function(){return NotificationsService.notifications;},function(notifications){$scope.notifications=notifications;});});
'use strict';var app=angular.module('workover');app.controller('Students/ListCtrl',function($scope,$location,CourseSelector,Student){$scope.students=null;$scope.course=null;var loadStudents=function(courseId){$scope.students=null;Student.list({'course_id':courseId}).then(function(students){$scope.students=students;});}
$scope.$watch(function(){return CourseSelector.currentCourse},function(currentCourse){if(currentCourse.id){$scope.course=currentCourse;loadStudents(currentCourse.id);}});var getSelectedStudents=function(){var ids=[];var length=$scope.students.length;for(var i=0;i<length;i++){if($scope.students[i].selected){ids.push($scope.students[i].id);}}
return ids;}
$scope.remove=function(){var ids=getSelectedStudents();Student.remove({'course_id':CourseSelector.currentCourse.id,'user_ids':ids}).then(function(){loadStudents(CourseSelector.currentCourse.id);});};$scope.resetPassword={error:false,newPassword:'',confirmNewPassword:'',reset:function(){if($scope.resetPassword.newPassword==$scope.resetPassword.confirmNewPassword&&$scope.resetPassword.newPassword.length>2){var ids=getSelectedStudents();Student.reset_password({user_ids:ids,password:$scope.resetPassword.newPassword}).then(function(){loadStudents(CourseSelector.currentCourse.id);$scope.resetPassword.newPassword='';$scope.resetPassword.confirmNewPassword='';$scope.resetPassword.error=false;$('#reset-password').modal('hide');});}else{$scope.resetPassword.error=true;}}};});
'use strict';var app=angular.module('workover');app.controller('Students/AddCtrl',function($scope,$location,CourseSelector,Student,NotificationsService){$scope.students=[];$scope.numStudents=10;$scope.doneUploading=false;$scope.fileUploaded=function(students){$scope.students=students;$scope.numStudents=students.length;NotificationsService.push({title:'Success!',message:'Students Loaded.',type:'success'});};$scope.updateNumStudents=function(){var length=$scope.students.length;if($scope.numStudents<length){var howMany=length-$scope.numStudents;$scope.students.splice(-howMany,howMany);}else if($scope.numStudents>length){var howMany=$scope.numStudents-length;for(var i=0;i<howMany;i++){$scope.students.push({});}}};$scope.addStudents=function(){NotificationsService.push({title:'Adding students...',type:'info'});Student.add({course_id:CourseSelector.currentCourse.id,students:$scope.students}).then(function(response){var length=response.length;var atLeastOneFailed=false;if(response.length==$scope.students.length){for(var i=0;i<length;i++){$scope.students[i].success=response[i].success;if(!response[i].success){atLeastOneFailed=true;}}
if(atLeastOneFailed){NotificationsService.push({title:'Warning!',message:'At least one student has failed to be added to the specified course.'});}else{NotificationsService.push({title:'Success!',message:'All students have been added to the specified course.',type:'success'});$scope.doneUploading=true;}}else{NotificationsService.push({title:'Unexpected respone from server!',message:'Reload page, and contact us if this problem persists.',type:'error'});}})};$scope.goBack=function(){$location.url('/students/list');};$scope.resetStudents=function(){$scope.students=[];$scope.updateNumStudents();$scope.doneUploading=false;};$scope.updateNumStudents();});
'use strict';var app=angular.module('workover');app.controller('Courses/ListCtrl',function($scope,$timeout,Course,CourseSelector,Authuser){$scope.courses=null;var loadCourses=function(){$scope.courses=null;CourseSelector.afterLoad.then(function(){$scope.courses=CourseSelector.courses;});}
$scope.remove=function(){var ids=[];var length=$scope.courses.length;for(var i=0;i<length;i++){if($scope.courses[i].selected){ids.push($scope.courses[i].id);}}
Course.remove_from_user({'user_id':Authuser.id,'course_ids':ids}).then(function(){CourseSelector.reloadCourses();loadCourses();});};loadCourses();});
'use strict';var app=angular.module('workover');app.controller('Courses/AddCtrl',function($scope,$location,Course,CourseSelector,Authuser,NotificationsService){var loadQuestions=function(){Course.list().then(function(courses){$scope.courses=courses;});}
$scope.addExisting=function(){Course.add_to_user({'user_id':Authuser.id,'course_ids':[$scope.existingCourse]}).then(function(){CourseSelector.reloadCourses();$location.path('#/questions/list');});};var proccessing=false;$scope.addNew=function(){if(!proccessing){proccessing=true;$scope.newCourse.users=[Authuser.id];NotificationsService.push({title:'Loading...',message:'',type:'warning'});Course.create({question:$scope.newCourse}).then(function(){proccessing=false;CourseSelector.reloadCourses();$location.path('#/questions/list');},function(){proccessing=false;});}};$scope.courses={};$scope.newCourse={};loadQuestions();});
'use strict';var app=angular.module('workover');app.controller('Questions/ListCtrl',function($scope,CourseSelector,Question){$scope.questions=null;$scope.course={};var loadQuestions=function(courseId){$scope.courses=null;Question.list({'course_id':courseId,'include_tags':true}).then(function(questions){$scope.questions=questions;});}
$scope.$watch(function(){return CourseSelector.currentCourse},function(currentCourse){if(currentCourse.id){$scope.course=currentCourse;loadQuestions(currentCourse.id);}});});
